name: Examples Smoke

on:
  push:
    branches: ["main"]
  pull_request:

permissions:
  contents: read

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout provenact-examples
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - name: Checkout provenact-cli (pinned)
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
        with:
          repository: opertus-systems/provenact-cli
          ref: 9f1a73fe4125cd5cd30cdf1f13b6666fee781887
          path: provenact-cli
      - name: Link provenact-cli sibling path
        run: ln -sfn "$GITHUB_WORKSPACE/provenact-cli" "$GITHUB_WORKSPACE/../provenact-cli"
      - uses: dtolnay/rust-toolchain@4be9e76fd7c4901c61fb841f559994984270fce7
      - name: Build provenact-cli
        run: |
          cargo build -p provenact-cli --manifest-path "$GITHUB_WORKSPACE/provenact-cli/Cargo.toml"
      - name: Run smoke demos
        run: ./scripts/smoke.sh
